<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Risk Gewinnwahrscheinlichkeit</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }
  input {
    width: 80px;
    margin-right: 10px;
  }
  button {
    padding: 6px 12px;
  }
  #result {
    margin-top: 15px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h2>Risk – Gewinnwahrscheinlichkeit (exakt)</h2>

<label>Angreifer (A):</label>
<input type="number" id="attackers" min="1" value="5">

<label>Verteidiger (V):</label>
<input type="number" id="defenders" min="1" value="3">

<button onclick="calculate()">Berechnen</button>

<div id="result"></div>

<script>
/*
  Würfel-Ergebniswahrscheinlichkeiten
  Format:
  key = "a-d"  (a = Angreiferwürfel, d = Verteidigerwürfel)
  value = Array von [VerlustA, VerlustV, Wahrscheinlichkeit]
*/
const outcomeProbabilities = {
  "1-1": [
    [1, 0, 21/36],
    [0, 1, 15/36]
  ],
  "2-1": [
    [1, 0, 91/216],
    [0, 1, 125/216]
  ],
  "3-1": [
    [1, 0, 441/1296],
    [0, 1, 855/1296]
  ],
  "1-2": [
    [1, 0, 161/216],
    [0, 1, 55/216]
  ],
  "2-2": [
    [2, 0, 581/1296],
    [1, 1, 420/1296],
    [0, 2, 295/1296]
  ],
  "3-2": [
    [2, 0, 2275/7776],
    [1, 1, 2611/7776],
    [0, 2, 2890/7776]
  ]
};

// Memoisierungstabelle
const memo = new Map();

function winProbability(A, V) {
  // Abbruchbedingungen
  if (V === 0) return 1;
  if (A === 0) return 0;

  const key = A + "," + V;
  if (memo.has(key)) return memo.get(key);

  const aDice = Math.min(3, A);
  const dDice = Math.min(2, V);
  const outcomes = outcomeProbabilities[aDice + "-" + dDice];

  let probability = 0;

  for (const [lossA, lossV, p] of outcomes) {
    probability += p * winProbability(A - lossA, V - lossV);
  }

  memo.set(key, probability);
  return probability;
}

function calculate() {
  memo.clear();

  const A = parseInt(document.getElementById("attackers").value);
  const V = parseInt(document.getElementById("defenders").value);

  if (A <= 0 || V <= 0) {
    document.getElementById("result").innerText =
      "Angreifer und Verteidiger müssen größer als 0 sein.";
    return;
  }

  const p = winProbability(A, V);
  document.getElementById("result").innerText =
    "Gewinnwahrscheinlichkeit Angreifer: " +
    (p * 100).toFixed(2) + " %";
}
</script>

</body>
</html>